<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Biker Tapizados</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      background:#121212;
      color:white;
      padding:20px;
      max-width:600px;
      margin:auto;
    }
    .form-container {
      background: #1e1e1e;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }
    h2 {
      color: aqua;
      text-align: center;
    }
    .input-wrapper {
      position: relative;
      margin-bottom: 16px;
    }
    .input-wrapper label {
      display: block;
      margin-bottom: 5px;
      color: #ccc;
    }
    .input-wrapper input,
    .input-wrapper select {
      width: 100%;
      padding: 12px;
      border: 1px solid #555;
      border-radius: 4px;
      font-size: 15px;
      background-color: #333;
      color: #fff;
      box-sizing: border-box;
    }
    .input-wrapper input:focus,
    .input-wrapper select:focus {
      border-color: aqua;
      outline: none;
    }
    button {
      width: 100%;
      padding: 12px;
      background: aqua;
      color: #121212;
      font-size: 16px;
      font-weight: bold;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background: #00ffffcc;
    }
    .cancel-btn {
      background: #f44336;
      color: white;
    }
    .cancel-btn:hover {
      background: #d32f2f;
    }
  </style>
</head>
<body>

  <!-- Registrar nuevo servicio -->
  <div class="form-container">
    <h2>Registrar nuevo servicio</h2>
    <form id="registerForm">
      <div class="input-wrapper">
        <label for="fullName">Nombre completo</label>
        <input type="text" id="fullName" required>
      </div>
      <div class="input-wrapper">
        <label for="email">Correo electr√≥nico</label>
        <input type="email" id="email" required>
      </div>
      <div class="input-wrapper">
        <label for="phone">Tel√©fono (10 d√≠gitos)</label>
        <input type="tel" id="phone" required>
      </div>
      <div class="input-wrapper">
        <label for="city">Ciudad (Colombia)</label>
        <input type="text" id="city" required>
      </div>
      <div class="input-wrapper">
        <label for="serviceType">Tipo de Servicio</label>
        <select id="serviceType" required>
          <option value="" disabled selected>Selecciona un servicio</option>
          <option value="Tapizado Personalizado">Tapizado Personalizado</option>
          <option value="Servicio al cliente">Servicio al cliente</option>
          <option value="Reparaci√≥n Silla">Reparaci√≥n Silla</option>
          <option value="Consulta General">Consulta General</option>
        </select>
      </div>
      <button type="submit">Registrar Servicio</button>
    </form>
  </div>

  <!-- Solicitar otro servicio -->
  <div class="form-container">
    <h2>Solicitar otro servicio</h2>
    <form id="newServiceForm">
      <div class="input-wrapper">
        <label for="emailLookup">Correo registrado</label>
        <input type="email" id="emailLookup" required>
      </div>
      <div class="input-wrapper">
        <label for="newService">Nuevo servicio</label>
        <select id="newService" required>
          <option value="" disabled selected>Seleccione nuevo servicio</option>
          <option value="Tapizado Personalizado">Tapizado Personalizado</option>
          <option value="Servicio al cliente">Servicio al cliente</option>
          <option value="Reparaci√≥n Silla">Reparaci√≥n Silla</option>
          <option value="Consulta General">Consulta General</option>
        </select>
      </div>
      <button type="submit">Agregar Servicio</button>
    </form>
  </div>

  <!-- Cancelar servicio -->
  <div class="form-container">
    <h2 style="color:#f44336;">Cancelar servicio</h2>
    <form id="cancelForm">
      <div class="input-wrapper">
        <label for="cancelEmail">Correo registrado</label>
        <input type="email" id="cancelEmail" required>
      </div>
      <div class="input-wrapper">
        <label for="cancelService">Servicio a cancelar</label>
        <select id="cancelService" required>
          <option value="" disabled selected>Seleccione servicio a cancelar</option>
          <option value="Tapizado Personalizado">Tapizado Personalizado</option>
          <option value="Servicio al cliente">Servicio al cliente</option>
          <option value="Reparaci√≥n Silla">Reparaci√≥n Silla</option>
          <option value="Consulta General">Consulta General</option>
        </select>
      </div>
      <button type="submit" class="cancel-btn">Cancelar Servicio</button>
    </form>
  </div>

  <script>
    const API_URL = "https://mi-proyecto-biker.onrender.com/clientes";

    document.getElementById('phone').addEventListener('input', function () {
      this.value = this.value.replace(/\D/g, '').slice(0, 10);
    });

    document.getElementById('registerForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const data = {
        nombre: document.getElementById('fullName').value,
        email: document.getElementById('email').value,
        telefono: document.getElementById('phone').value,
        ciudad: document.getElementById('city').value,
        pais: "Colombia",
        servicio: document.getElementById('serviceType').value
      };
      if (data.telefono.length !== 10) {
        alert("‚ùå El tel√©fono debe tener 10 d√≠gitos exactos");
        return;
      }
      try {
        const res = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });
        const result = await res.json();
        if (res.ok) {
          alert(`‚úÖ Servicio registrado:\nCliente: ${result.cliente?.nombre || data.nombre}\nServicio: ${result.cliente?.servicio || data.servicio}`);
          e.target.reset();
        } else {
          alert("‚ùå Error: " + (result.mensaje || "No se pudo registrar"));
        }
      } catch (error) {
        alert("‚ùå Error al conectar con la API");
      }
    });

    document.getElementById('newServiceForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('emailLookup').value;
      const newService = document.getElementById('newService').value;
      try {
        const res = await fetch(API_URL);
        const data = await res.json();
        const cliente = data.find(c => c.email === email);
        if (!cliente) {
          alert("‚ùå No se encontr√≥ cliente con ese correo.");
          return;
        }
        const newRequest = { ...cliente, servicio: newService };
        const postRes = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(newRequest)
        });
        const postResult = await postRes.json();
        alert(`‚úÖ Nuevo servicio agregado: ${postResult.cliente?.servicio || newService}`);
        e.target.reset();
      } catch (error) {
        alert("‚ùå Error al agregar servicio");
      }
    });

    document.getElementById('cancelForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const data = {
        email: document.getElementById('cancelEmail').value,
        servicio: document.getElementById('cancelService').value
      };
      try {
        const res = await fetch(API_URL, {
          method: "DELETE",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });
        const result = await res.json();
        alert(`üóëÔ∏è ${result.mensaje}`);
        e.target.reset();
      } catch (error) {
        alert("‚ùå Error al cancelar servicio");
      }
    });
  </script>

</body>
</html>